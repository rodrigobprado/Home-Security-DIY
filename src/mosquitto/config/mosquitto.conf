# =============================================================================
# Mosquitto MQTT Broker Configuration
# Home Security DIY
# =============================================================================
# ReferÃªncia: https://mosquitto.org/man/mosquitto-conf-5.html

# --- Listener ---
listener 1883
protocol mqtt

# WebSocket listener (for browser-based clients)
listener 9001
protocol websockets

# --- Authentication ---
# To create the password file:
#   docker exec home-security-mosquitto mosquitto_passwd -c /mosquitto/config/password_file homeassistant
#   docker exec home-security-mosquitto mosquitto_passwd -b /mosquitto/config/password_file zigbee2mqtt <password>
#   docker exec home-security-mosquitto mosquitto_passwd -b /mosquitto/config/password_file frigate <password>
allow_anonymous false
password_file /mosquitto/config/password_file
acl_file /mosquitto/config/acl_file

# --- Persistence ---
persistence true
persistence_location /mosquitto/data/

# --- Logging ---
log_dest file /mosquitto/log/mosquitto.log
log_dest stdout
log_type error
log_type warning
log_type notice
log_type information
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# --- Security ---
# Max inflight messages per client
max_inflight_messages 20

# Max queued messages per client
max_queued_messages 1000

# Max packet size (256KB - sufficient for snapshots)
message_size_limit 262144

# Connection timeout
connection_messages true
